 <div class="row" id="content_div">
  <div class="col-lg-12">
  <div class="panel">
    <div class="panel-body">
      <script src="http://code.highcharts.com/highcharts.js"></script>
      <script src="http://code.highcharts.com/modules/exporting.js"></script>
      <div id="unit_pie_chart" style="min-width: 310px; height: 400px; max-width: 600px; margin: 0 auto"></div>
    
    <hr> 
    <div class="table-responsive">
    <%#= render :text => Buyer.first.to_json %>
      <table class="table table-bordered">
        <tbody>
          <tr>
            <th>type</th>
            <th>Unit</th>
          </tr>
          <tr>
            <td>Sold:</td>
            <td><%= sold = @lots.where("status_id = 3").count %></td>
          </tr>
          <tr>
            <td>Available:</td>
            <td><%= available = @lots.where("status_id = 1").count %></td>
          </tr>
          <tr>
            <td>Reserved:</td>
            <td><%= reserved = @lots.where("status_id = 2").count %></td>
          </tr>
          <tr>
            <td>Total Unit:</td>
            <td><%= @lots.count %></td>
          </tr>
          <tr></tr>
          <tr>
            <th>GDV</th>
            <th></th>
          </tr>
          <tr>
            <td>Sold Unit</td>
            <td>
              <% sold_price = 0 %>
              <% @sales.where("status_id = 2").each do |p| %>
                <% lot = Lot.find_by_id(p.lot_unit_id) %>
                  <% if p.buyer.race == 2 %>
                    <% sold_price += p.bumi_putera_price %>
                  <% else %>
                    <% sold_price += lot.selling_price %>
                  <% end %>
              <% end %>
              RM<%= number_with_delimiter(sold_price) %>
            </td>
          </tr>
          <tr>
            <td>Available Unit</td>
            <td>
              <% available_price = 0 %>
              <% @lots.order("id ASC").each do |p| %>
                  <% if p.status_id == 1 %>
                    <% available_price += p.selling_price %>
                  <% end %>
              <% end %>
              RM<%= number_with_delimiter(available_price) %>
            </td>
          </tr>
          <tr>
            <td>Reserved Unit</td>
            <td>
              <% reserved_price = 0 %>
              <% @sales.where("status_id = 1").each do |p| %>
                <% lot = Lot.find_by_id(p.lot_unit_id) %>
                <% if p.buyer.try(:race) == 2 %>
                    <% reserved_price += p.bumi_putera_price %>
                  <% else %>
                    <% reserved_price += lot.selling_price %>
                  <% end %>
              <% end %>
              RM<%= number_with_delimiter(reserved_price) %>
            </td>
          </tr>
         <!--  <tr>
            <td>Total</td>
            <td>
              <%# total_arr = [] %>
              <%# @sales.order("id ASC").each do |p| %>
                <%# lot = Lot.find_by_id(p.lot_unit_id) %>
                <%# if p.buyer.race == 2 %>
                  <%# total_arr << p.bumi_putera_price %>
                <%# else %>
                  <%# total_arr << lot.selling_price %>
                <%# end %>
              <%# end %>
              <%#= total_arr.sum %>
            </td>
          </tr> -->
        </tbody>
        
      </table>
      <%#= link_to "Export Excel", ideal_export_excel_developer_customers_path(format: "xls"), :class=>"btn btn-default" %>
    </div>
  </div>
</div>
</div>
</div>

<script type="text/javascript">
  $(function () {

            var combine = <%= raw sold.to_json %>
            var sold = <%= sold %>
            var available = <%= available %>
            var reserved = <%= reserved %>
            console.log(sold, reserved, available);


            var unit_cart = [["Sold", sold],["Available", available],["Reserved", reserved]];
            $('#unit_pie_chart').highcharts({
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: 1,//null,
                    plotShadow: false
                },
                title: {
                    text: 'Analysis Unit Report.'
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.0f} %</b>'
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: true,
                            format: '<b>{point.name}</b>: {point.percentage:.0f} %',
                            style: {
                                color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                            }
                        }
                    }
                  },
                series: [{
                    type: 'pie',
                    name: 'Browser share',
                    data: unit_cart
                          // arrayMy
                        // ['Firefox',   40.0],
                        // ['IE',       20.0],
                        // // {
                        // //     name: 'Chrome',
                        // //     y: 12.8,
                        // //     sliced: true,
                        // //     selected: true
                        // // }, 
                }]
            });
          });

</script>
